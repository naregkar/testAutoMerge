name: 'Get Jira Status'
on:
  #repository_dispatch:
  #  types: MergeMasterToRelease
  #workflow_dispatch:
  pull_request:
    branches: 
      - master
env:
  GITHUB_PR_TITLE: ${{github.event.pull_request.title}}     
 
jobs:
  read-jira-status:
    runs-on: ubuntu-latest
    
    steps:
    
    - name: Get Jira Issue ID
      run: |
            echo "$GITHUB_PR_TITLE"
            JiraIdUnparsed=$GITHUB_PR_TITLE
            JiraId=${JiraIdUnparsed%]*}
            JiraId=${JiraId:1}
            echo "jira_id=$JiraId" >> $GITHUB_ENV
    
    - name: Read Jira Issue Status
      id: retrieveJiraStatus
      run: |
            restApiGET=$(curl --request GET \
                  --url 'https://naregkar.atlassian.net/rest/api/3/issue/${{ env.jira_id }}/' \
                  --user 'nareg.karamanoukian@picsart.com:oBJTrxuI3qf0Do1MBpGbBE87' \
                  --header 'Accept: application/json' | jq '.fields.status.name');                   
             #echo $restApiGET
             echo "jiraIssue_status=$restApiGET" >> $GITHUB_ENV
             
    - name: Display Status
      run: |
            echo ${{ env.jiraIssue_status }}
            
    - name: Assess the Status / To Do
      if: ${{ env.jiraIssue_status }} == 'To Do'
      run: |
            echo "To Do"
            
    - name: Assess the Status / Done
      if: ${{ env.jiraIssue_status }} == 'Done'
      run: |
            echo "Done"
              

              
             
